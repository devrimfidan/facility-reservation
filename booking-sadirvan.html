<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KU Campus - Booking Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        .text-ku-purple { color: #4338ca; } 
        .focus\:ring-ku-purple:focus { --tw-ring-color: #4338ca; }
        .focus\:border-ku-purple:focus { --tw-border-color: #4338ca; }
        .hover\:text-ku-purple:hover { color: #4338ca; }
        .bg-ku-purple-light { background-color: #ede9fe; }
        .bg-ku-purple-new { background-color: #824aef; }
        .hover\:bg-ku-purple-new-hover:hover { background-color: #713de6; } 
        .bg-powerbi-yellow { background-color: #F2C811; }
        .hover\:bg-powerbi-yellow-hover:hover { background-color: #e0b80f; }
        body { height: 100vh; } 
    </style>
</head>

<body class="antialiased flex flex-col">

    <!-- Header -->
    <header class="h-16 bg-white border-b border-gray-200 px-6 flex items-center justify-between shadow-sm sticky top-0 z-30 flex-shrink-0">
        <div class="flex items-center">
            <svg class="w-6 h-6 mr-3 text-ku-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
            <span class="text-xl font-bold text-ku-purple tracking-wide">KU Campus</span>
        </div>
        
        <div class="flex items-center space-x-3">
            <button class="text-gray-500 hover:text-ku-purple">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-2.81A3 3 0 0018 10V8a6 6 0 10-12 0v2c0 1.5.54 2.92 1.405 4.19L4 17h5m6 0v1a3 3 0 01-6 0v-1m6 0H9"></path></svg>
            </button>
            <div class="flex items-center space-x-2 cursor-pointer">
                <span class="text-sm font-medium text-gray-700 hidden sm:block">Alparslan O.</span>
                <img class="h-8 w-8 rounded-full object-cover" src="https://placehold.co/32x32/14b8a6/FFFFFF?text=AO" alt="User Avatar">
                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-16 sm:w-64 bg-slate-800 flex-shrink-0 overflow-y-auto">
            <div class="p-4 text-white">
                <p class="hidden sm:block text-xs font-medium uppercase tracking-wider mb-4 text-indigo-400">Navigation Menu</p>
                <ul class="space-y-3 text-sm">
                    <li class="group">
                        <a href="index.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                            <span class="hidden sm:block">Home</span>
                        </a>
                    </li>
                    <li class="group">
                        <a href="search-reserve.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            <span class="hidden sm:block">Search & Reserve</span>
                        </a>
                    </li>
                    <li class="group">
                        <a href="my-reservations.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <span class="hidden sm:block">My Reservations</span>
                        </a>
                    </li>
                    <li class="group">
                        <a href="manage-reservations.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                            <span class="hidden sm:block">Manage Reservations</span>
                        </a>
                    </li>
                    <li class="group">
                        <a href="student-availability.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            <span class="hidden sm:block">Student Availability</span>
                        </a>
                    </li>
                    <li class="group">
                        <a href="manage-facilities.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M3 12h18M3 17h18"></path></svg>
                            <span class="hidden sm:block">Manage Facilities</span>
                        </a>
                    </li>
                    <li>
                        <a href="powerbi-reports.html" class="flex items-center p-2 rounded-lg text-gray-400 hover:bg-slate-700 hover:text-white transition duration-150">
                            <svg class="w-6 h-6 sm:mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 3a1 1 0 0 0-1 1v16a1 1 0 0 0 2 0V4a1 1 0 0 0-1-1Zm5 4a1 1 0 0 0-1 1v12a1 1 0 0 0 2 0V8a1 1 0 0 0-1-1Zm5 3a1 1 0 0 0-1 1v9a1 1 0 0 0 2 0v-9a1 1 0 0 0-1-1Zm5-4a1 1 0 0 0-1 1v13a1 1 0 0 0 2 0V7a1 1 0 0 0-1-1Z"/></svg>
                            <span class="hidden sm:block">Power BI Reports</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 overflow-y-auto flex flex-col">
            <main class="flex-grow p-6 pb-20">
                
                <div class="mb-6">
                    <nav class="text-xs sm:text-sm text-gray-500 mb-4">
                        <a href="index.html" class="text-gray-400 hover:text-ku-purple">Home</a> / 
                        <a href="search-reserve.html" class="text-gray-400 hover:text-ku-purple">Search & Reserve</a> /
                        <span class="font-semibold text-ku-purple">Booking Details</span>
                    </nav>
                    <h1 class="text-2xl font-bold text-gray-800">Booking Details</h1>
                </div>

                <!-- Booking Form Card -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 border-b pb-4">Confirm Your Reservation</h2>
                    
                    <!-- Facility Image Gallery -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Facility Images</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="relative overflow-hidden rounded-lg shadow-md">
                                <img src="https://api3.talentrocket.de/files/lawSchool/gallery/6452/20190725_sadirvan_koc_university_talentrocket_web.jpg" alt="≈ûadƒ±rvan - View 1" class="w-full h-56 object-cover hover:scale-105 transition duration-300 cursor-pointer" onclick="openImageModal(this.src)">
                            </div>
                            <div class="relative overflow-hidden rounded-lg shadow-md">
                                <img src="https://cssh.ku.edu.tr/wp-content/uploads/2024/02/dji_0001.jpg" alt="≈ûadƒ±rvan - View 2" class="w-full h-56 object-cover hover:scale-105 transition duration-300 cursor-pointer" onclick="openImageModal(this.src)">
                            </div>
                            <div class="relative overflow-hidden rounded-lg shadow-md">
                                <img src="https://studykoy.com/wp-content/uploads/2020/07/1-e1720098343274.jpg" alt="≈ûadƒ±rvan - View 3" class="w-full h-56 object-cover hover:scale-105 transition duration-300 cursor-pointer" onclick="openImageModal(this.src)">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Facility Details -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Facility Details</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-4 bg-gray-50 p-6 rounded-lg">
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Facility Code</p>
                                <p class="text-sm text-gray-900">≈ûADIRVAN</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Facility Type</p>
                                <p class="text-sm text-gray-900">Commoon Room</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Facility Capacity</p>
                                <p class="text-sm text-gray-900">50</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Campus</p>
                                <p class="text-sm text-gray-900">MAIN</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Building</p>
                                <p class="text-sm text-gray-900">SOS</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Room</p>
                                <p class="text-sm text-gray-900">≈ûADIRVAN</p>
                            </div>
                        </div>
                    </div>

                    <!-- Facility Properties -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Facility Properties</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-4 bg-gray-50 p-6 rounded-lg">
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">White Board</p>
                                <p class="text-sm text-gray-900">0</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Projector</p>
                                <p class="text-sm text-gray-900">0</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Connection Options</p>
                                <p class="text-sm text-gray-900">Undefined</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Document Camera</p>
                                <p class="text-sm text-gray-900">No</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Socket For Students</p>
                                <p class="text-sm text-gray-900">No</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Window</p>
                                <p class="text-sm text-gray-900">No</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Class Recording System</p>
                                <p class="text-sm text-gray-900">No</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Camera</p>
                                <p class="text-sm text-gray-900">No</p>
                            </div>
                            <div class="flex justify-between">
                                <p class="text-sm font-medium text-gray-600">Digital Pen</p>
                                <p class="text-sm text-gray-900">No</p>
                            </div>
                        </div>
                    </div>

                    <!-- Facility Availability Calendar -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-700">Facility Availability Calendar</h3>
                            <div class="flex items-center gap-2">
                                <button type="button" id="prevWeekBtn" title="Previous week" aria-label="Previous week" class="px-3 py-1.5 rounded-lg border text-gray-700 hover:bg-gray-100">Prev</button>
                                <span id="calendarRangeLabel" class="text-sm font-medium text-gray-600">Week</span>
                                <button type="button" id="nextWeekBtn" title="Next week" aria-label="Next week" class="px-3 py-1.5 rounded-lg border text-gray-700 hover:bg-gray-100">Next</button>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div id="availabilityCalendar" class="space-y-2" aria-live="polite">
                                <div class="text-sm text-gray-500">Loading availability‚Ä¶</div>
                            </div>
                            <div class="mt-3 text-xs text-gray-500">Purple = Reserved, empty space = Available (08:00‚Äì20:00)</div>
                        </div>
                    </div>

                    <!-- Booking Details Form -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Booking Details</h3>
                        <form class="bg-gray-50 p-6 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                
                                <!-- Column 1 -->
                                <div class="space-y-4">
                                    <!-- Booking Start Date -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="bookingStartDate" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            <span class="text-red-600">*</span> Booking Start Date
                                        </label>
                                        <input type="date" id="bookingStartDate" class="w-full sm:w-2/3 border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple transition duration-150" required>
                                    </div>

                                    <!-- Start Time -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="startTime" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            <span class="text-red-600">*</span> Start Time
                                        </label>
                                        <input type="time" id="startTime" class="w-full sm:w-2/3 border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple transition duration-150" required>
                                    </div>

                                    <!-- Reservation Type -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="reservationType" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            <span class="text-red-600">*</span> Reservation Type
                                        </label>
                                        <select id="reservationType" class="w-full sm:w-2/3 border border-gray-300 rounded-lg p-2.5 bg-white focus:ring-ku-purple focus:border-ku-purple appearance-none transition duration-150" required>
                                            <option value="">Select Reservation Type</option>
                                            <option>Discussion Group</option>
                                            <option>Class Examination</option>
                                            <option>Recruiting Fair</option>
                                            <option>Information Session</option>
                                            <option>Interview</option>
                                            <option>Make-up Class/Session</option>
                                            <option>Meeting</option>
                                            <option>Reception</option>
                                            <option>Seminar</option>
                                            <option>Campus Tour</option>
                                            <option>Workshop</option>
                                            <option>Other</option>
                                            <option>Makeup of Final Exam</option>
                                            <option>Mid-Term Exam</option>
                                            <option>Final Exam</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Column 2 -->
                                <div class="space-y-4">
                                    <!-- Booking End Date -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="bookingEndDate" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            <span class="text-red-600">*</span> Booking End Date
                                        </label>
                                        <input type="date" id="bookingEndDate" class="w-full sm:w-2/3 border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple transition duration-150" required>
                                    </div>

                                    <!-- End Time -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="endTime" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            <span class="text-red-600">*</span> End Time
                                        </label>
                                        <input type="time" id="endTime" class="w-full sm:w-2/3 border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple transition duration-150" required>
                                    </div>

                                    <!-- Description -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="description" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            Description
                                        </label>
                                        <input type="text" id="description" class="w-full sm:w-2/3 border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple transition duration-150" placeholder="Brief description of the reservation">
                                    </div>
                                </div>
                            </div>

                            

                            <!-- Exam Options (Conditional) -->
                            <div id="examOptions" class="hidden mt-6 pt-6 border-t border-gray-200">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Course Search -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                                        <label for="courseSearch" class="text-sm font-medium text-gray-700 w-full sm:w-1/3 mb-1 sm:mb-0 sm:pr-4 flex-shrink-0">
                                            Course
                                        </label>
                                        <div class="w-full sm:w-2/3 relative">
                                            <input type="text" id="courseSearch" class="w-full border border-gray-300 rounded-lg p-2.5 pr-10 focus:ring-ku-purple focus:border-ku-purple transition duration-150" placeholder="Search for a course">
                                            <button type="button" onclick="openClassSearchModal()" title="Search for course" aria-label="Search for course" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-ku-purple transition">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Checkboxes -->
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-6">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" id="combined" class="w-4 h-4 text-ku-purple border-gray-300 rounded focus:ring-ku-purple">
                                            <span class="ml-2 text-sm text-gray-700">Combined</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" id="applyToSelections" class="w-4 h-4 text-ku-purple border-gray-300 rounded focus:ring-ku-purple">
                                            <span class="ml-2 text-sm text-gray-700">Apply To Selections</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end space-x-4 pt-6">
                            <a href="search-reserve.html" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-8 rounded-xl shadow-md transition duration-150">
                                Cancel
                            </a>
                            <button type="submit" class="bg-ku-purple-new hover:bg-ku-purple-new-hover text-white font-semibold py-2 px-8 rounded-xl shadow-md transition duration-150">
                                Confirm Reservation
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Request Services Card (separate, collapsible) -->
                <div class="bg-white rounded-xl shadow-lg p-8 mt-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Request Services</h3>
                            <p class="text-sm text-gray-500">Open service requests to supporting departments</p>
                        </div>
                        <div class="flex items-center">
                            <button id="servicesToggle" type="button" role="switch" aria-checked="false" aria-controls="requestServicesPanel" title="Toggle Request Services" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 transition">
                                <span id="servicesToggleKnob" class="inline-block h-5 w-5 rounded-full bg-white translate-x-0 transition"></span>
                            </button>
                            <span id="servicesToggleLabel" class="ml-3 text-sm text-gray-700">Off</span>
                        </div>
                    </div>

                    <div class="mt-4 hidden" id="requestServicesPanel">
                        <div class="mb-4 rounded-lg border border-amber-200 bg-amber-50 text-amber-800 p-3 text-sm">
                            Note: This only opens a request to the related department. For procurement, you must still create a SAS in the SAP system.
                        </div>

                        <div class="space-y-4" id="requestServices">
                            <!-- Food & Catering Service -->
                            <section class="border border-gray-200 rounded-xl p-4 bg-white shadow-sm" id="service-food">
                                <div class="flex items-start gap-3">
                                    <label class="mt-1">
                                        <input type="checkbox" class="service-toggle w-4 h-4 text-ku-purple border-gray-300 rounded focus:ring-ku-purple" data-target="#service-food" aria-label="Toggle Food & Catering Service" title="Toggle Food & Catering Service">
                                    </label>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 font-medium text-gray-800">
                                            <span aria-hidden="true">üçΩÔ∏è</span>
                                            <span>Food & Catering Service</span>
                                        </div>
                                        <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3 service-fields">
                                            <div>
                                                <label class="text-xs text-gray-600 block mb-1">Number of People</label>
                                                <input type="number" name="food_people" class="service-input w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple" placeholder="Enter number" disabled>
                                            </div>
                                            <div class="md:col-span-2">
                                                <label class="text-xs text-gray-600 block mb-1">Additional Information</label>
                                                <textarea name="food_notes" class="service-input w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple" placeholder="Any special requirements or notes..." rows="2" disabled></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Tea & Coffee Service -->
                            <section class="border border-gray-200 rounded-xl p-4 bg-white shadow-sm" id="service-tea">
                                <div class="flex items-start gap-3">
                                    <label class="mt-1">
                                        <input type="checkbox" class="service-toggle w-4 h-4 text-ku-purple border-gray-300 rounded focus:ring-ku-purple" data-target="#service-tea" aria-label="Toggle Tea & Coffee Service" title="Toggle Tea & Coffee Service">
                                    </label>
                                    <div class="flex-1">
        
                                        <div class="flex items-center gap-2 font-medium text-gray-800">
                                            <span aria-hidden="true">‚òï</span>
                                            <span>Tea & Coffee Service</span>
                                        </div>
                                        <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3 service-fields">
                                            <div>
                                                <label class="text-xs text-gray-600 block mb-1">Number of People</label>
                                                <input type="number" name="tea_people" class="service-input w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple" placeholder="Enter number" disabled>
                                            </div>
                                            <div class="md:col-span-2">
                                                <label class="text-xs text-gray-600 block mb-1">Additional Information</label>
                                                <textarea name="tea_notes" class="service-input w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple" placeholder="Any special requirements or notes..." rows="2" disabled></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Audio/Visual Equipment -->
                            <section class="border border-gray-200 rounded-xl p-4 bg-white shadow-sm" id="service-av">
                                <div class="flex items-start gap-3">
                                    <label class="mt-1">
                                        <input type="checkbox" class="service-toggle w-4 h-4 text-ku-purple border-gray-300 rounded focus:ring-ku-purple" data-target="#service-av" aria-label="Toggle Audio Visual Equipment" title="Toggle Audio Visual Equipment">
                                    </label>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 font-medium text-gray-800">
                                            <span aria-hidden="true">üéß</span>
                                            <span>Audio/Visual Equipment</span>
                                        </div>
                                        <div class="mt-3 service-fields">
                                            <label class="text-xs text-gray-600 block mb-1">Additional Information</label>
                                            <textarea name="av_notes" class="service-input w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple" placeholder="Any special requirements or notes..." rows="2" disabled></textarea>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Wi‚ÄëFi Setup -->
                            <section class="border border-gray-200 rounded-xl p-4 bg-white shadow-sm" id="service-wifi">
                                <div class="flex items-start gap-3">
                                    <label class="mt-1">
                                        <input type="checkbox" class="service-toggle w-4 h-4 text-ku-purple border-gray-300 rounded focus:ring-ku-purple" data-target="#service-wifi" aria-label="Toggle Wi‚ÄëFi Setup" title="Toggle Wi‚ÄëFi Setup">
                                    </label>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 font-medium text-gray-800">
                                            <span aria-hidden="true">üì∂</span>
                                            <span>Wi‚ÄëFi Setup</span>
                                        </div>
                                        <div class="mt-3 service-fields">
                                            <label class="text-xs text-gray-600 block mb-1">Additional Information</label>
                                            <textarea name="wifi_notes" class="service-input w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple" placeholder="Any special requirements or notes..." rows="2" disabled></textarea>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Summary + Actions -->
                        <div class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                            <div class="rounded-xl border border-purple-200 bg-purple-50 p-3 text-sm text-purple-800">
                                <span id="servicesSelectedCount" class="font-semibold">0</span> Services Requested
                            </div>
                            <div class="flex gap-2 justify-end">
                                <button id="makeRequestBtn" type="button" class="bg-ku-purple-new hover:bg-ku-purple-new-hover text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50">Make Request</button>
                                <button id="updateRequestBtn" type="button" class="border border-gray-300 text-gray-700 hover:bg-gray-100 font-semibold py-2 px-4 rounded-lg disabled:opacity-50" disabled>Update Request</button>
                                <button id="cancelRequestBtn" type="button" class="border border-gray-300 text-gray-700 hover:bg-gray-100 font-semibold py-2 px-4 rounded-lg disabled:opacity-50" disabled>Cancel Request</button>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
        
    <!-- Footer -->
    <footer class="w-full bg-slate-800 text-white text-xs p-3 flex justify-end items-center z-40 sticky bottom-0 flex-shrink-0">
        <div class="flex items-center space-x-4">
            <span>Copyright ¬© 2025 Ko√ß University Version 9.1.12</span>
            <a href="#" class="hover:text-indigo-400">Privacy Policy</a>
            <a href="#" class="hover:text-indigo-400">Cookie Policy</a>
        </div>
    </footer>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-50" onclick="closeImageModal()">
        <div class="max-w-4xl max-h-screen p-4">
            <img id="modalImage" src="" alt="Facility Image" class="max-w-full max-h-screen object-contain rounded-lg">
        </div>
    </div>

    <!-- Class Search Modal -->
    <div id="classSearchModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden" onclick="event.stopPropagation()">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b">
                <h2 class="text-xl font-semibold text-gray-800">Class Search</h2>
                <button type="button" onclick="closeClassSearchModal()" title="Close" aria-label="Close modal" class="text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-140px)]">
                <form class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Subject Area -->
                        <div>
                            <label for="subjectArea" class="text-sm font-medium text-gray-700 mb-2 block">Subject Area</label>
                            <select id="subjectArea" class="w-full border border-gray-300 rounded-lg p-2.5 bg-white focus:ring-ku-purple focus:border-ku-purple">
                                <option value="">Select</option>
                            </select>
                        </div>
                        
                        <!-- Catalog Number -->
                        <div>
                            <label for="catalogNumber" class="text-sm font-medium text-gray-700 mb-2 block">Catalog Number</label>
                            <input type="text" id="catalogNumber" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Class Number -->
                        <div>
                            <label for="classNumber" class="text-sm font-medium text-gray-700 mb-2 block">Class Number</label>
                            <input type="text" id="classNumber" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple">
                        </div>
                        
                        <!-- Section -->
                        <div>
                            <label for="section" class="text-sm font-medium text-gray-700 mb-2 block">Section</label>
                            <input type="text" id="section" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Description -->
                        <div>
                            <label for="classDescription" class="text-sm font-medium text-gray-700 mb-2 block">Description</label>
                            <input type="text" id="classDescription" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-ku-purple focus:border-ku-purple">
                        </div>
                        
                        <!-- Component -->
                        <div>
                            <label for="component" class="text-sm font-medium text-gray-700 mb-2 block">Component</label>
                            <select id="component" class="w-full border border-gray-300 rounded-lg p-2.5 bg-white focus:ring-ku-purple focus:border-ku-purple">
                                <option value="">Select</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Term -->
                    <div>
                        <label for="term" class="text-sm font-medium text-gray-700 mb-2 block">Term</label>
                        <select id="term" class="w-full border border-gray-300 rounded-lg p-2.5 bg-white focus:ring-ku-purple focus:border-ku-purple">
                            <option value="">Select</option>
                        </select>
                    </div>
                </form>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex justify-end p-6 border-t space-x-3">
                <button type="button" onclick="closeClassSearchModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition">
                    Cancel
                </button>
                <button type="button" class="bg-ku-purple-new hover:bg-ku-purple-new-hover text-white font-semibold py-2 px-6 rounded-lg transition">
                    Search
                </button>
            </div>
        </div>
    </div>

    <!-- Reservation Detail Modal -->
    <div id="reservationDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" onclick="closeReservationDetailModal()">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center p-6 border-b">
                <h2 class="text-lg font-semibold text-gray-800">Reservation Details</h2>
                <button type="button" onclick="closeReservationDetailModal()" title="Close" aria-label="Close modal" class="text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-3">
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600">Date</span>
                    <span id="rdmDate" class="font-medium text-gray-900">‚Äî</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600">Time</span>
                    <span id="rdmTime" class="font-medium text-gray-900">‚Äî</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-600">Reserved By</span>
                    <span id="rdmPerson" class="font-medium text-gray-900">‚Äî</span>
                </div>
                <div class="text-sm">
                    <div class="text-gray-600 mb-1">Description</div>
                    <div id="rdmDescription" class="text-gray-900">‚Äî</div>
                </div>
            </div>
            <div class="flex justify-end p-6 border-t">
                <button type="button" onclick="closeReservationDetailModal()" class="px-6 py-2 rounded-lg bg-ku-purple-new hover:bg-ku-purple-new-hover text-white font-semibold">Close</button>
            </div>
        </div>
    </div>

    <script>
        function openImageModal(src) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = src;
            modal.classList.remove('hidden');
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeImageModal();
                closeClassSearchModal();
                closeReservationDetailModal();
            }
        });

        // Handle Reservation Type change to show/hide exam options
        document.addEventListener('DOMContentLoaded', function() {
            const reservationType = document.getElementById('reservationType');
            const examOptions = document.getElementById('examOptions');
            
            reservationType.addEventListener('change', function() {
                const selectedValue = this.value;
                const examTypes = ['Class Examination', 'Makeup of Final Exam', 'Mid-Term Exam', 'Final Exam'];
                
                if (examTypes.includes(selectedValue)) {
                    examOptions.classList.remove('hidden');
                } else {
                    examOptions.classList.add('hidden');
                }
            });

            // Request Services: enable/disable fields and update summary
            function updateServicesCount() {
                const count = document.querySelectorAll('#requestServices .service-toggle:checked').length;
                const el = document.getElementById('servicesSelectedCount');
                if (el) el.textContent = String(count);
            }

            function setServiceEnabled(section, enabled) {
                const inputs = section.querySelectorAll('.service-input');
                inputs.forEach(i => {
                    i.disabled = !enabled;
                    if (!enabled) {
                        i.value = '';
                    }
                });
                section.classList.toggle('opacity-50', !enabled);
            }

            // Helpers for Request Services Actions
            const servicesPanel = document.getElementById('requestServicesPanel');
            const servicesToggle = document.getElementById('servicesToggle');
            const servicesToggleKnob = document.getElementById('servicesToggleKnob');
            const servicesToggleLabel = document.getElementById('servicesToggleLabel');
            let requestMade = false;

            function isPanelOn() {
                return servicesToggle && servicesToggle.getAttribute('aria-checked') === 'true';
            }

            function refreshActionButtons() {
                const count = document.querySelectorAll('#requestServices .service-toggle:checked').length;
                const makeBtn = document.getElementById('makeRequestBtn');
                const updateBtn = document.getElementById('updateRequestBtn');
                const cancelBtn = document.getElementById('cancelRequestBtn');

                if (makeBtn) makeBtn.disabled = count === 0 || !isPanelOn();
                if (updateBtn) updateBtn.disabled = !requestMade || !isPanelOn();
                if (cancelBtn) cancelBtn.disabled = !requestMade || !isPanelOn();
            }

            function showBanner(message, type = 'success') {
                const panel = document.getElementById('requestServicesPanel');
                if (!panel) return;
                // remove existing banner
                const old = document.getElementById('servicesBanner');
                if (old) old.remove();

                const div = document.createElement('div');
                div.id = 'servicesBanner';
                const styles = type === 'success'
                    ? 'border-green-200 bg-green-50 text-green-800'
                    : 'border-gray-200 bg-gray-50 text-gray-800';
                div.className = `mb-4 rounded-lg border ${styles} p-3 text-sm`;
                div.textContent = message;
                panel.insertBefore(div, panel.firstChild);
                setTimeout(() => { div.remove(); }, 3000);
            }

            document.querySelectorAll('#requestServices .service-toggle').forEach(cb => {
                const targetSel = cb.getAttribute('data-target');
                const section = document.querySelector(targetSel);
                if (!section) return;
                // initialize disabled
                setServiceEnabled(section, cb.checked);
                cb.addEventListener('change', () => {
                    setServiceEnabled(section, cb.checked);
                    updateServicesCount();
                    refreshActionButtons();
                });
            });
            updateServicesCount();

            // Wire toggle switch for Request Services panel
            if (servicesToggle && servicesPanel && servicesToggleKnob && servicesToggleLabel) {
                servicesToggle.addEventListener('click', () => {
                    const on = servicesToggle.getAttribute('aria-checked') !== 'true';
                    servicesToggle.setAttribute('aria-checked', on ? 'true' : 'false');
                    servicesToggleLabel.textContent = on ? 'On' : 'Off';
                    servicesPanel.classList.toggle('hidden', !on);
                    servicesToggleKnob.style.transform = on ? 'translateX(20px)' : 'translateX(0)';
                    refreshActionButtons();
                });
            }

            // Action buttons
            const makeBtn = document.getElementById('makeRequestBtn');
            const updateBtn = document.getElementById('updateRequestBtn');
            const cancelBtn = document.getElementById('cancelRequestBtn');

            if (makeBtn) {
                makeBtn.addEventListener('click', () => {
                    const count = document.querySelectorAll('#requestServices .service-toggle:checked').length;
                    if (count === 0) return;
                    requestMade = true;
                    showBanner('Service request submitted successfully.');
                    refreshActionButtons();
                });
            }

            if (updateBtn) {
                updateBtn.addEventListener('click', () => {
                    if (!requestMade) return;
                    showBanner('Service request updated.');
                });
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    // Clear all selections and inputs
                    document.querySelectorAll('#requestServices .service-toggle').forEach(cb => {
                        cb.checked = false;
                        const targetSel = cb.getAttribute('data-target');
                        const section = document.querySelector(targetSel);
                        if (section) setServiceEnabled(section, false);
                    });
                    updateServicesCount();
                    requestMade = false;
                    refreshActionButtons();
                    showBanner('Service request cancelled.', 'neutral');
                });
            }

            // Initial state
            refreshActionButtons();
        });

        // Class Search Modal functions
        function openClassSearchModal() {
            const modal = document.getElementById('classSearchModal');
            modal.classList.remove('hidden');
        }

        function closeClassSearchModal() {
            const modal = document.getElementById('classSearchModal');
            modal.classList.add('hidden');
        }

        // Reservation Detail Modal
        function openReservationDetailModal(reservation) {
            const modal = document.getElementById('reservationDetailModal');
            const fmtDate = new Date(reservation.start).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' });
            const fmtStart = new Date(reservation.start).toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
            const fmtEnd = new Date(reservation.end).toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
            document.getElementById('rdmDate').textContent = fmtDate;
            document.getElementById('rdmTime').textContent = `${fmtStart} - ${fmtEnd}`;
            document.getElementById('rdmPerson').textContent = reservation.person || '‚Äî';
            document.getElementById('rdmDescription').textContent = reservation.description || '‚Äî';
            modal.classList.remove('hidden');
        }

        function closeReservationDetailModal() {
            const modal = document.getElementById('reservationDetailModal');
            modal.classList.add('hidden');
        }

        // Availability Calendar Rendering
        (function() {
            const hourStart = 8; // 08:00
            const hourEnd = 20;  // 20:00
            const totalMinutes = (hourEnd - hourStart) * 60;
            const pxPerMinute = 1; // 1px per minute => 12h = 720px
            const calendarHeight = totalMinutes * pxPerMinute;

            // Sample reservations for the facility (placeholder data)
            const facilityReservations = [
                { id: 1, start: '2025-11-17T10:00:00', end: '2025-11-17T12:00:00', person: 'Jane Doe', description: 'Midterm Review Session' },
                { id: 2, start: '2025-11-18T09:30:00', end: '2025-11-18T11:00:00', person: 'Registrar', description: 'Advising Meeting' },
                { id: 3, start: '2025-11-19T13:00:00', end: '2025-11-19T15:00:00', person: 'John Smith', description: 'Project Workshop' },
                { id: 4, start: '2025-11-21T16:30:00', end: '2025-11-21T18:00:00', person: 'Exam Office', description: 'Make-up Exam' }
            ];

            function startOfWeek(date) {
                const d = new Date(date);
                const day = (d.getDay() + 6) % 7; // Monday=0
                d.setHours(0,0,0,0);
                d.setDate(d.getDate() - day);
                return d;
            }

            function addDays(date, n) {
                const d = new Date(date);
                d.setDate(d.getDate() + n);
                return d;
            }

            function sameDay(a, b) {
                return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();
            }

            function minutesFromStart(date) {
                const h = date.getHours();
                const m = date.getMinutes();
                return (h - hourStart) * 60 + m;
            }

            function clamp(val, min, max) { return Math.max(min, Math.min(max, val)); }

            let currentWeekStart = startOfWeek(new Date());

            function renderCalendar() {
                const container = document.getElementById('availabilityCalendar');
                if (!container) return;
                container.innerHTML = '';

                // Header with day names (top)
                const header = document.createElement('div');
                header.className = 'grid grid-cols-8 text-xs font-medium text-gray-600 mb-2';
                header.style.gridTemplateColumns = '96px repeat(7, minmax(0, 1fr))';
                const timeTitle = document.createElement('div');
                timeTitle.className = 'text-left';
                timeTitle.textContent = 'Time';
                header.appendChild(timeTitle);
                for (let i = 0; i < 7; i++) {
                    const d = addDays(currentWeekStart, i);
                    const cell = document.createElement('div');
                    cell.className = 'text-center';
                    cell.textContent = d.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
                    header.appendChild(cell);
                }
                container.appendChild(header);

                // Body grid: first column = time scale, next 7 = day columns
                const body = document.createElement('div');
                body.className = 'grid grid-cols-8 gap-2';
                body.style.gridTemplateColumns = '96px repeat(7, minmax(0, 1fr))';

                // Time scale column
                const timeCol = document.createElement('div');
                timeCol.className = 'relative bg-white border rounded';
                timeCol.style.height = calendarHeight + 'px';
                for (let h = hourStart; h <= hourEnd; h++) {
                    const top = (h - hourStart) * 60 * pxPerMinute;
                    const line = document.createElement('div');
                    line.className = 'absolute left-0 right-0 border-t border-gray-200';
                    line.style.top = top + 'px';
                    timeCol.appendChild(line);

                    const label = document.createElement('div');
                    label.className = 'absolute -translate-y-1/2 left-2 text-xs text-gray-600 bg-white/70 px-1';
                    label.style.top = top + 'px';
                    label.textContent = String(h).padStart(2, '0') + ':00';
                    timeCol.appendChild(label);
                }
                body.appendChild(timeCol);

                // Day columns
                for (let i = 0; i < 7; i++) {
                    const dayCol = document.createElement('div');
                    dayCol.className = 'relative bg-white border rounded overflow-hidden';
                    dayCol.style.height = calendarHeight + 'px';

                    // Hour grid lines per day
                    for (let h = hourStart; h <= hourEnd; h++) {
                        const top = (h - hourStart) * 60 * pxPerMinute;
                        const line = document.createElement('div');
                        line.className = 'absolute left-0 right-0 border-t border-gray-200';
                        line.style.top = top + 'px';
                        dayCol.appendChild(line);
                    }

                    // Reservations for this day
                    const dayDate = addDays(currentWeekStart, i);
                    const todays = facilityReservations.filter(r => sameDay(new Date(r.start), dayDate));
                    todays.forEach(r => {
                        const rs = new Date(r.start);
                        const re = new Date(r.end);
                        let startMin = minutesFromStart(rs);
                        let endMin = minutesFromStart(re);
                        startMin = clamp(startMin, 0, totalMinutes);
                        endMin = clamp(endMin, 0, totalMinutes);
                        const top = startMin * pxPerMinute;
                        const height = Math.max(6, (endMin - startMin) * pxPerMinute);

                        const block = document.createElement('button');
                        block.type = 'button';
                        block.title = 'View reservation';
                        block.setAttribute('aria-label', 'View reservation');
                        block.className = 'absolute left-1 right-1 rounded-md bg-ku-purple-new hover:bg-ku-purple-new-hover text-white text-xs px-2 py-1 shadow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-ku-purple';
                        block.style.top = top + 'px';
                        block.style.height = height + 'px';
                        block.textContent = `${new Date(r.start).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})} - ${new Date(r.end).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`;
                        block.addEventListener('click', () => openReservationDetailModal(r));
                        dayCol.appendChild(block);
                    });

                    body.appendChild(dayCol);
                }

                container.appendChild(body);

                // Update range label
                const rangeLabel = document.getElementById('calendarRangeLabel');
                const endOfWeek = addDays(currentWeekStart, 6);
                rangeLabel.textContent = `${currentWeekStart.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })} - ${endOfWeek.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })}`;
            }

            // Wire up buttons
            document.addEventListener('DOMContentLoaded', function() {
                const prev = document.getElementById('prevWeekBtn');
                const next = document.getElementById('nextWeekBtn');
                if (prev && next) {
                    prev.addEventListener('click', () => { currentWeekStart = addDays(currentWeekStart, -7); renderCalendar(); });
                    next.addEventListener('click', () => { currentWeekStart = addDays(currentWeekStart, 7); renderCalendar(); });
                }
                renderCalendar();
            });
        })();
    </script>

</body>
</html>
